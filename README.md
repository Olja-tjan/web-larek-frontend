# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных

Данные карточки товара

```
export interface IProduct {
  id: string;
  description?: string;
  image?: string;
  title?: string;
  category?: string;
  price: number;
}
```

Данные заказа пользователя

```
export interface IOrder {
  payment: 'online' | 'upon receipt';
  email: string;
  phone: string;
  address: string;
  total: number;
  items: string[];
}
```

Данные используемые для подсчёта суммы:

```
export type TProductPrice = Pick<IProduct, 'price'>;
```

Данные используемые в формах при оформлении заказа:

```
export type TOrderForm = Pick<IOrder, 'address'>;
```

```
export type TPayment = Pick<IOrder, 'payment'>;
```

```
export type TContactsForm = Pick<IOrder, 'email' | 'phone'>;
```

## Архитектура проекта

Код приложения разделён на слои согласно парадигме MVP:
- Model - слой данных, отвечает за хранение и изменение данных
- View - слой представления, отвечает за отображения данных на странице
- Presentor - презентор, отвечает за связь представления и данных

### Базовый код

#### Класс <span style="color:#993131">Api</span>
Содержит базовую логику отправки запросов. В конструктор передаётся базовый адрес сервера и опциональный объект с заголовками запросов.
Методы класса:
- `get` - выполняет `GET` запрос на переданный в параметрах эндпоинт и возвращает промис с объектом (ответ сервера)
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на эндпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может переопределён через третий параметр при вызове.

#### Класс <span style="color:#993131">EventEmitter</span>
Брокер событий позволяет подписываться на события и отправлять события. Класс используется в презентере для обработки событий и генерации событий.
Основные методы класса, реализуемые интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие. Это позволяет передавать его в качестве обработчика события в другие классы. Эти классы будут генерировать события, не будучи при этом напрямую зависимыми от
класса  EventEmitter .

Дополнительно реализованы методы:
- `off` - отписка от события
- `onAll` - подписка на все события
- `offAll` - сброс подписки от всех событий

### Слой данных (Model)

#### 1. Класс <span style="color:#993131">CardsData</span>
Класс отвечает за хранение и передачу данных карточек товаров.\
Конструктор класса принимает экземпляр брокера событий.

В полях класса хранятся следущие данные:
- `_cards: IProduct[]` - массив объектов карточек товаров
- `_preview: string | null` - id карточки товара, выбранной для детального просмотра в модальном окне\

Класс предоставляет набор методов для взаимодействия с данными:
- `getCard(productId: string): IProduct` - возвращает карточку товара по её id
- Геттеры и сеттеры для получения и сохранения данных из полей класса

#### 2. Класс <span style="color:#993131">OrderData</span>

Класс отвечает за хранение и передачу данных заказа.\
Конструктор класса принимает экземпляр брокера событий.

Поля класса:

- `_payment: 'online' | 'upon receipt'` - способ оплаты
- `_email: string` - почта пользователя
- `_phone: string` - номер телефона пользователя
- `_address: string` - адресс пользователя
- `_total: number` - сумма товаров
- `_items: string[]` - массив из id заказанных товаров
- `products: IProduct[]` - массив товаров добавленных в корзину
- `amountProducts: number | null` - количество товаров в корзине
  
Класс предоставляет набор методов для взаимодействия с данными:

- `addProduct(productId: string): void` - добавляет товар в корзину
- `deleteProduct(productId: string): void` - удаляет товар из корзины
- `сountProducts(products: IProduct[]): number | null` - счётчик товаров в корзине
- `сountTotal(products: TProductPrice[]): number | null` - считает общую сумму заказанных товаров
- `checkActiveSelectButton(data: Record<keyof TPayment, 'online' | 'upon receipt'>): boolean` - проверяет активность кнопки в поле выбора при оформлении заказа
- `checkValidationOrderForm(data: Record<keyof TOrderForm, string>): boolean` - проверяет объект с данными пользователя для оформления заказа на валидность
- `checkValidationContactsForm(data: Record<keyof TContactsForm, string>): boolean` - проверяет объект с контактными данными пользователя на валидность

### Слой представления (View)

#### 1. Класс <span style="color:#993131">Modal</span>

Класс реализует модальное окно. Представляет методы open и close для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.

- `constructor(templateElement: string, events: IEvents)` Конструктор принимает темплейт-элемент, которому в разметке страницы будет идентифициравано модальное окно и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса:
- `modal: HTMLElement` - элемент модального окна
- `events: IEvents` - брокер событий

#### 2. Класс <span style="color:#993131">ItemBasket</span>

Отвечает за отображение товара в корзине, задавая в товаре его номер в списке, названия и цены. В конструктор класса передается DOM элемент темплейта, что позволяет при необходимости формировать элемент товара в разных вариантов вёрстки.
Конструктор, кроме темплейта принимает экземпляр `EventEmitter` для инициации событий.\

Поля класса:
 
- `indexBasketElement: HTMLElement` - элемент разметки с номером товара в списке корзины
- `titleBasketElement: HTMLElement` - элемент разметки с названием товара
- `priceBasketElement: HTMLElement` - элемент разметки с ценой товара
- `buttonDelete: HTMLButtonElement` - кнопка удаления товара из корзины

Методы класса:

- `render(cardData: IProduct): HTMLElement` - заполняет атрибуты элементов карточки данными. Метод возвращает заполненную разметку карточки
- геттер `_id` возвращает уникальный id карточки

#### 3. Класс <span style="color:#993131">ModalWithBasket</span>

Расширяет класс Modal. Предназначен для реализации модального окна корзины. При оформлении заказа инициирует событие передавая в него объект с массивом товаров и суммой заказа. При изменении данных в полях ввода инициирует событие изменения данных. Предоставляет методы управления активностью кнопки продолжения (оформить). В конструктор принимает контейнер, в котором размещаются карточки товара.

Поля класса:
 
- `basketList: HTMLElement` - элемент разметки контейнер для товаров
- `titleBasketElement: HTMLElement` - элемент разметки с названием модального окна
- `totalBasketElement: HTMLElement` - элемент разметки с суммой заказанных товаров
- `buttonBasket: HTMLButtonElement` - кнопка офрмить заказ

Методы класса:

- `renderItems(items: IProduct[]):void` - для рендера карточек на странице

#### 4. Класс <span style="color:#993131">ModalWithForm</span>

Расширяет класс Modal. Предназначен для реализации модального окна с формой содержащей поля ввода. При сабмите инициирует событие передавая в него объект с данными из полей ввода формы. При изменении данных в полях ввода инициирует событие изменения данных. Предоставляет методы для отображения ошибок и управления активностью кнопки продолжения (далее или оплатить).

Поля класса :

- `submitButton: HTMLButtonElement` - кнопка продолжения
- `_form: HTMLFormElement` - элемент формы
- `formName: string` - значение атрибута name формы
- `inputs: NodeListOf<HTMLInputElement>` - коллекция всех полей ввода формы
- `errors: Record<string, HTMLElement>` - объект хранящий все элементы для вывода ошибок под полями формы с привязкой к атрибуту name инпутов.

Методы:

- `setValid(isValid: boolean): void` - изменяет активность кнопки подтверждения
- `getInputValues(): Record<string, string>` - возвращает объект с данными из полей формы, где ключ - name инпута, значение - данные введенные пользователем.
- `getButtonValues(): Record<keyof TPayment, string>` - возвращает объект с данными в зависимости от выбранной кнопки, где ключ - поле `payment` из объекта заказа, значение - данные выбранные пользователем.
- `setInputValues(data: Record<string, string>): void` - принимает объект с данными для заполнения полей формы
- `setError(data: { field: string, value: string, validInformation: string }): void` - принимает объект с данными для отображения или сокрытия текстов ошибок под полями ввода
- `showInputError(field: string, errorMessage: string): void` - отображает полученный текст ошибки под указанным полем ввода
- `hideInputError(field: string): void` - скрывает текст ошибки под указанным полем ввода
- `close(): void` - расширяет родительский метод дополнительно при закрытии очищая поля формы и деактивируя кнопку сохранения
- геттер `form: HTMLElement` - геттер для получения элемента формы

#### 5. Класс <span style="color:#993131">ModalWithSuccess</span>

Расширяет класс Modal. Предназначен для реализации модального окна успешно оформленного заказа.

Поля класса :

- `descriptionTotalOrder: HTMLElement` - элемент разметки с описанием списанной суммы заказа
- `buttonClose: HTMLButtonElement` - дополнительная кнопка закрытия

Методы:

- `close(): void` - расширяет родительский метод, при закрытии очищает корзину
- `closeSuccess(): void` - позволяет закрыть модальное окно на дополнительную кнопку
- `геттер _total(): number` - геттер для получения суммы заказа
- `сеттер _total(): void` - устанавливает сумму заказа в элементе разметки

#### 6. Класс <span style="color:#993131">ModalWithPreview</span>

Расширяет класс Modal. Предназначен для реализации модального окна детального просмотра карточки. При открытии модального окна получает данные карточки товара, которые нужно показать.

Поля класса:

- `imageCardElement: HTMLImageElement` - элемент разметки с изображением
- `categoryCardElement: HTMLElement` - элемент разметки с категорией товара
- `titleCardElement: HTMLElement` - элемент разметки с названием товара
- `descriptionCardElement: HTMLElement` - элемент разметки с описанием товара
- `priceCardElement: HTMLElement` - элемент разметки с ценой товара
- `cardButton: HTMLButtonElement` - кнопка добавления товара в корзину. Если в корзине выбранный товар уже есть, вместо кнопки добавления - кнопка удаления товара из корзины

Методы:

- `open(data: { image: string, category: string, title: string, description: string, price: number}): void` - расширение родительского метода, принимает данные изображения, которые используются для заполнения атрибутов элементов модального окна
- `close(): void` - расширяет родительский метод, выполняя дополнительно очистку атрибутов модального окна
- `buttonState(): void` - изменяет состояние кнопки в зависимости от наличия выбранного товара в корзине

#### 7. Класс <span style="color:#993131">Card</span>
Отвечает за отображение карточки товара, задавая в карточке данные изображения, названия, категории и цены. Класс используется для отображения карточек на странице сайта. В конструктор класса передается DOM элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов вёрстки.
Конструктор, кроме темплейта принимает экземпляр `EventEmitter` для инициации событий.\

Поля класса:

- `categoryCardElement: HTMLElement` - элемент разметки с категорией товара
- `titleCardElement: HTMLElement` - элемент разметки с названием товара
- `imageCardElement: HTMLImageElement` - элемент разметки с изображением
- `priceCardElement: HTMLElement` - элемент разметки с ценой товара

Методы:

- `render(cardData: IProduct): HTMLElement` - заполняет атрибуты элементов карточки данными. Метод возвращает заполненную разметку карточки
- геттер `_id` возвращает уникальный id карточки

#### 8. Класс <span style="color:#993131">Section</span>

Отвечает за отображение блока с карточками на главной странице. Предоставляет метод `renderItems(items: IProduct[])` для рендера карточек на странице. В конструктор принимает контейнер, в котором размещаются карточки товара.

### Презентер (Presenter)

#### Класс <span style="color:#993131">AppApi</span>

Принимает в конструктор экземпляр класса `Api` и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)*
- `productsBasket:changed` - изменение массива карточек товаров
- `order:changed` - изменение данных заказа
- `productsBasket:changed` - изменение массива карточек товаров в корзине
- `card:selected` - изменение открываемой в модальном окне карточки товара
- `card:previewClear` - необходима очистка данных выбранной для показа в модальном окне карточки товара

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `card:select` - выбор карточки товара для отображения в модальном окне
- `card:add` - добавление выбранной карточки товара в корзину
- `card:delete` - удаления выбранной карточки товара из корзины
- `basket:open` - открытие модального окна корзины
- `order:open` - открытие модального окна с формой заполнения данных пользователя для заказа
- `contacts:open` - открытие модального окна с формой заполнения контактных данных пользователя для заказа
- `success:open` - открытие модального окна успешно завершённого заказа
- `order:input` - изменение данных в форме с данными пользователя для заказа
- `contacts:input` - изменение данных в форме с контактными данными пользователя
- `basket:submit` - сохранение данных списка заказанных товаров и суммы заказа в модальном окне
- `order:submit` - сохранение данных пользователя для заказа в модальном окне
- `contacts:submit` - сохранение контактных данных пользователя для заказа в модальном окне
- `order:validation` - событие, сообщающее о необходимости валидации формы с данными пользователя для заказа
- `contacts:validation` - событие, сообщающее о необходимости валидации формы с контактными данными пользователя
